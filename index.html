<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gobindapur Govt. High School</title> 

<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
.hero{position:relative;height:220px}
.hero img{width:100%;height:100%;object-fit:cover}
.hero-text{
position:absolute;inset:0;
background:rgba(0,0,0,.55);
color:#fff;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
text-align:center
}
nav{background:#084298;padding:10px;text-align:center}
nav button{
background:#0b5ed7;color:#fff;border:none;
padding:10px 16px;margin:4px;
border-radius:20px;font-size:14px
}
.container{padding:15px}
.card{
background:#fff;padding:15px;border-radius:12px;
box-shadow:0 3px 6px rgba(0,0,0,.15);
margin-bottom:15px
}
select,input,button{width:100%;padding:10px;margin:6px 0}
.admin{background:#eef;padding:10px;border-radius:10px;margin-top:10px;display:none}
.list li{margin:6px 0}
.list button{background:red;color:#fff;border:none;border-radius:12px;padding:4px 10px}
.fade{animation:fade .5s ease}
@keyframes fade{
from{opacity:0;transform:scale(.95)}
to{opacity:1;transform:scale(1)}
}
footer{background:#0b5ed7;color:#fff;text-align:center;padding:10px}
table{
width:100%;
border-collapse:collapse;
margin-top:10px
}
th,td{
border:1px solid #ccc;
padding:8px;
text-align:center
}
th{
background:#0b5ed7;
color:#fff
}

/* ========= BEAUTIFUL BUTTON DESIGN ========= */

/* рж╕ржм ржмрж╛ржЯржирзЗрж░ ржЬржирзНржп */
button{
  background: linear-gradient(135deg, #0d6efd, #0b5ed7);
  color: #fff;
  border: none;
  padding: 12px 18px;
  margin: 6px 0;
  border-radius: 30px;
  font-size: 14px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 6px 12px rgba(0,0,0,.2);
  transition: all .3s ease;
}

/* Hover ржХрж░рж▓рзЗ */
button:hover{
  transform: translateY(-2px);
  box-shadow: 0 10px 18px rgba(0,0,0,.25);
}

/* Click ржХрж░рж▓рзЗ */
button:active{
  transform: scale(.95);
}

/* Navigation ржмрж╛ржЯржи (ржЙржкрж░рзЗ ржорзЗржирзБ) */
nav button{
  background: linear-gradient(135deg, #20c997, #0d6efd);
  border-radius: 25px;
  padding: 10px 16px;
  font-size: 13px;
}

/* Delete (X) ржмрж╛ржЯржи */
.list button{
  background: linear-gradient(135deg, #dc3545, #b02a37);
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 12px;
}

/* ===== Student Result Card ===== */
.student-card{
  margin-top:12px;
  padding:15px;
  border-radius:15px;
  background:linear-gradient(135deg,#e3f2fd,#ffffff);
  box-shadow:0 6px 15px rgba(0,0,0,.15);
  animation:fade .4s ease;
}

.student-card h3{
  margin:0 0 8px;
  color:#0b5ed7;
}

.student-card p{
  margin:4px 0;
  font-size:14px;
}

.not-found{
  margin-top:10px;
  padding:12px;
  border-radius:12px;
  background:#ffe5e5;
  color:#b02a37;
  font-weight:bold;
  text-align:center;
}

/* Teacher Card Style */
.teacher-card{
  background: linear-gradient(135deg,#e3f2fd,#ffffff);
  padding: 12px;
  border-radius: 15px;
  box-shadow: 0 6px 15px rgba(0,0,0,.15);
  margin: 10px 0;
  transition: transform .3s ease, box-shadow .3s ease;
}

.teacher-card:hover{
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(0,0,0,.25);
}

.teacher-card h3{
  margin:0 0 6px;
  color:#0b5ed7;
  font-size:16px;
}

.teacher-card p{
  margin:2px 0;
  font-size:14px;
}

/* ===== DARK MODE ===== */
body.dark{
  background:#121212;
  color:#e0e0e0;
}

body.dark nav{
  background:#1f1f1f;
}

body.dark .card{
  background:#1e1e1e;
  color:#e0e0e0;
  box-shadow:0 6px 15px rgba(0,0,0,.6);
}

body.dark footer{
  background:#1f1f1f;
  color:#ccc;
}

body.dark input,
body.dark select{
  background:#2a2a2a;
  color:#fff;
  border:1px solid #444;
}

body.dark table th{
  background:#0d6efd;
}

body.dark table td{
  background:#1e1e1e;
  color:#fff;
  border-color:#333;
}

body.dark .admin{
  background:#1b1b1b;
  border:2px dashed #0d6efd;
}

body.dark .teacher-card,
body.dark .student-card{
  background:linear-gradient(135deg,#1e1e1e,#2a2a2a);
}

body.dark .not-found{
  background:#3a1a1a;
  color:#ff8a8a;
}

/* ===== Floating Dark Mode Button ===== */
#darkBtn{
  position:fixed;
  top:15px;
  right:15px;
  z-index:2000;

  width:45px;
  height:45px;
  border-radius:50%;

  font-size:18px;
  padding:0;

  background:linear-gradient(135deg,#0d6efd,#0b5ed7);
  box-shadow:0 6px 15px rgba(0,0,0,.4);
}

#darkBtn{
  cursor:grab;
}

#darkBtn:active{
  cursor:grabbing;
}

/* Dark mode ржП ржмрж╛ржЯржи ржЖрж▓рж╛ржжрж╛ ржжрзЗржЦрж╛ржмрзЗ */
body.dark #darkBtn{
  background:linear-gradient(135deg,#ffc107,#ff9800);
  color:#000;
}

.bottom-nav button.active{
  color:#20c997;
  transform:scale(1.1);
}

/* ===== Bottom Navigation (Mobile App Style) ===== */
.bottom-nav{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:60px;

  background:#ffffff;
  display:flex;
  justify-content:space-around;
  align-items:center;

  box-shadow:0 -4px 12px rgba(0,0,0,.2);
  z-index:1500;
}

/* Bottom nav button */
.bottom-nav button{
  background:none;
  box-shadow:none;
  border-radius:0;
  padding:4px 0;
  font-size:20px;
  color:#0b5ed7;
}

/* Text under icon */
.bottom-nav span{
  display:block;
  font-size:11px;
  margin-top:2px;
}

/* Dark mode support */
body.dark .bottom-nav{
  background:#1f1f1f;
}

body.dark .bottom-nav button{
  color:#fff;
}

/* Mobile only */
@media (min-width:768px){
  .bottom-nav{
    display:none;
  }
}

/* Footer hide under bottom nav */
footer{
  margin-bottom:60px;
}

#myRoutine h4{
  margin-top:15px;
  color:#2c3e50;
}

#myRoutine table{
  width:100%;
  border-collapse:collapse;
  margin-bottom:20px;
}

#myRoutine th, #myRoutine td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}

#myRoutine th{
  background:#f1f3f6;
}

/* ===== Floating AI Button ===== */
#aiBtn{
  position:fixed;
  top:70px;              /* Dark button ржПрж░ ржирж┐ржЪрзЗ ржерж╛ржХржмрзЗ */
  right:15px;
  z-index:2000;

  width:60px;            /* ЁЯФе ржПржХржЯрзБ ржмрзЬ */
  height:60px;
  border-radius:50%;

  font-size:26px;
  padding:0;

  background:linear-gradient(135deg,#20c997,#0d6efd);
  box-shadow:0 6px 15px rgba(0,0,0,.4);

  cursor:pointer;
  transition:all .3s ease;
}

/* Hover effect */
#aiBtn:hover{
  transform:scale(1.1);
}

/* Active click */
#aiBtn:active{
  transform:scale(.95);
}

/* Dark mode ржП ржЖрж▓рж╛ржжрж╛ рж░ржВ */
body.dark #aiBtn{
  background:linear-gradient(135deg,#ffc107,#ff9800);
  color:#000;
}
</style>

</head>
<body>

<button id="darkBtn" onclick="toggleDark()">ЁЯМЩ</button>
<button id="aiBtn" onclick="show('ai')">ЁЯдЦ</button>
<header class="hero">
<img src="school.jpg">
<div class="hero-text">
<h1>Gobindapur Govt. High School</h1>
<p>Official School Website</p>
</div>
</header> 

<nav>
  <button onclick="show('notice')">ЁЯУв Notice</button>
  <button onclick="show('news')">ЁЯУ░ News</button>
  <button onclick="show('student')">ЁЯСитАНЁЯОУ Student</button>
  <button onclick="show('teacher')">ЁЯСйтАНЁЯПл Teacher</button>
  <button onclick="show('result')">ЁЯУК Result</button>
  <button onclick="show('routine')">ЁЯУЕ Routine</button>
  <button onclick="show('auth')">ЁЯУЭЁЯФС Register/Login</button> <!-- ржПржЦрж╛ржирзЗ ржирж╛ржо ржкрж░рж┐ржмрж░рзНрждржи -->
  <button onclick="show('admin')">ЁЯФР Admin</button>
</nav>

<div class="container"> 

<div class="card section" id="notice">
<h2>ЁЯУв ржирзЛржЯрж┐рж╢</h2>
<ul id="noticeList" class="list"></ul>
<div class="admin">
<input id="noticeInput" placeholder="ржирзЛржЯрж┐рж╢ рж▓рж┐ржЦрзБржи">
<button onclick="addNotice()">Add</button>
</div>
</div> 

<div class="card section" id="ai" style="display:none">
  <h2>ЁЯдЦ School AI Assistant</h2>

  <ul id="aiQuestionList" class="list"></ul>

  <!-- AI Answer Box -->
  <div id="aiAnswerBox" class="student-card" style="display:none">
    <h3>ЁЯдЦ AI Answer</h3>
    <p id="aiAnswerText"></p>
  </div>

  <!-- Admin Panel -->
  <div class="admin">
    <h3>тЮХ Add AI Question & Answer</h3>
    <input id="aiQ" placeholder="ржкрзНрж░рж╢рзНржи рж▓рж┐ржЦрзБржи">
    <textarea id="aiA" placeholder="ржЙрждрзНрждрж░ рж▓рж┐ржЦрзБржи" style="width:100%;height:80px"></textarea>
    <button onclick="addAIQA()">Add</button>
  </div>
</div>

<div class="card section" id="news" style="display:none">
<h2>ЁЯУ░ ржЦржмрж░</h2>
<ul id="newsList" class="list"></ul>
<div class="admin">
<input id="newsInput" placeholder="ржЦржмрж░ рж▓рж┐ржЦрзБржи">
<button onclick="addNews()">Add</button>
</div>
</div> 

<div class="card section" id="student" style="display:none">
<h2>ЁЯСитАНЁЯОУ рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзА</h2> 

<select id="sClass">
<option value="">ржХрзНрж▓рж╛рж╕ ржирж┐рж░рзНржмрж╛ржЪржи</option>
<option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
</select> 

<select id="sRoll">
<option value="">рж░рзЛрж▓ ржирж┐рж░рзНржмрж╛ржЪржи</option>
</select> 

<select id="sSection">
<option value="">рж╢рж╛ржЦрж╛ ржирж┐рж░рзНржмрж╛ржЪржи</option>
<option>Science</option><option>Arts</option><option>A</option><option>B</option>
</select> 

<button onclick="findStudent()">Search</button>
<div id="studentResult"></div> 

<div class="admin">
<input id="sn" placeholder="ржирж╛ржо">
<input id="sc" placeholder="ржХрзНрж▓рж╛рж╕">
<input id="sr" placeholder="рж░рзЛрж▓">
<input id="ss" placeholder="рж╢рж╛ржЦрж╛">
<button onclick="addStudent()">Add</button>
<ul id="studentList" class="list"></ul>
</div>
</div> 

<div class="card section" id="teacher" style="display:none">
<h2>ЁЯСйтАНЁЯПл рж╢рж┐ржХрзНрж╖ржХ</h2>
<ul id="teacherList" class="list"></ul>
<div class="admin">
<input id="tName" placeholder="ржирж╛ржо">
<input id="tSub" placeholder="ржмрж┐рж╖рзЯ">
<input id="tPhone" placeholder="ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░">
<button onclick="addTeacher()">Add</button>
</div>
</div> 

<div class="card section" id="result" style="display:none">
<h2>ЁЯУК рж░рзЗржЬрж╛рж▓рзНржЯ</h2> 

<select id="rClass">
<option value="">ржХрзНрж▓рж╛рж╕ ржирж┐рж░рзНржмрж╛ржЪржи</option>
<option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
</select> 

<select id="rRoll">
<option value="">рж░рзЛрж▓ ржирж┐рж░рзНржмрж╛ржЪржи</option>
</select> 

<select id="rSection">
<option value="">рж╢рж╛ржЦрж╛ ржирж┐рж░рзНржмрж╛ржЪржи</option>
<option>Science</option><option>Arts</option><option>A</option><option>B</option>
</select> 

<button onclick="findResult()">Search</button>
<div id="resultOutput"></div> 

<div class="admin">
<input id="resName" placeholder="ржирж╛ржо">
<input id="resClass" placeholder="ржХрзНрж▓рж╛рж╕">
<input id="resRoll" placeholder="рж░рзЛрж▓">
<input id="resSection" placeholder="рж╢рж╛ржЦрж╛">
<input id="resPos" placeholder="рж╕рзНржерж╛ржи (рззржо/рзирзЯ/рзйрзЯ)">
<input id="resMarks" placeholder="ржиржорзНржмрж░"> 

<button onclick="addResult()">Add</button> 

<ul id="resultList" class="list"></ul>
</div> 

</div>┬а┬а <!-- тнР ржПржЗ рж▓рж╛ржЗржиржЯрж╛ рждрзБржорж┐ ржпрзЛржЧ ржХрж░ржмрзЗ --> 

<div class="card section" id="routine" style="display:none">
<h2>ЁЯУЕ ржХрзНрж▓рж╛рж╕ рж░рзБржЯрж┐ржи</h2> 

<select id="rtClass">
<option value="">ржХрзНрж▓рж╛рж╕ ржирж┐рж░рзНржмрж╛ржЪржи</option>
<option>6</option><option>7</option><option>8</option>
<option>9</option><option>10</option>
</select> 

<select id="searchDay">
<option value="">рж╕ржм ржмрж╛рж░</option>
<option>рж░ржмрж┐</option>
<option>рж╕рзЛржо</option>
<option>ржоржЩрзНржЧрж▓</option>
<option>ржмрзБржз</option>
<option>ржмрзГрж╣ржГ</option>
</select> 

<button onclick="loadRoutine()">Show Routine</button> 

<div id="routineTable"></div> 

<div class="admin">
<h3>тЮХ рж░рзБржЯрж┐ржи ржпрзЛржЧ ржХрж░рзБржи</h3> 

<select id="addRtClass">
<option value="">ржХрзНрж▓рж╛рж╕ ржирж┐рж░рзНржмрж╛ржЪржи</option>
<option>6</option>
<option>7</option>
<option>8</option>
<option>9</option>
<option>10</option>
</select> 

<select id="rtDay">
<option value="">ржмрж╛рж░ ржирж┐рж░рзНржмрж╛ржЪржи</option>
<option>рж░ржмрж┐</option>
<option>рж╕рзЛржо</option>
<option>ржоржЩрзНржЧрж▓</option>
<option>ржмрзБржз</option>
<option>ржмрзГрж╣ржГ</option>
</select> 

<input id="rtPeriod" placeholder="ржкрж┐рж░рж┐рзЯржб (рззржо / рзирзЯ)">
<input id="rtSub" placeholder="ржмрж┐рж╖рзЯ">
<input id="rtTeacher" placeholder="рж╢рж┐ржХрзНрж╖ржХ"> 

<button onclick="addRoutine()">Add Routine</button>
</div>
</div> 

<div class="card section" id="admin" style="display:none">
<h2>ЁЯФР Admin Login</h2>
<h3>тП│ Pending Student Approval</h3>
<ul id="pendingList" class="list"></ul>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button onclick="autoFixOldStudents()">ЁЯЫа Fix Old Students</button>
<button onclick="login()">Login</button>
<button onclick="logout()">Logout</button>
<p id="status"></p>
</div> 

<div class="card section" id="auth" style="display:none">
  <h2>ЁЯУЭ Student Signup / Login</h2>

  <!-- Signup -->
  <h3>Signup</h3>
  <input id="upName" placeholder="ржирж╛ржо">
  <input id="upClass" placeholder="ржХрзНрж▓рж╛рж╕">
  <input id="upRoll" placeholder="рж░рзЛрж▓">
  <input id="upSection" placeholder="рж╢рж╛ржЦрж╛">
  <input id="upPhone" placeholder="ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░">
  <button onclick="signup()">Submit</button>
  <p id="signupMsg"></p>

  <hr>

  <!-- Login -->
  <h3>Login</h3>
  <input id="loginClass" placeholder="ржХрзНрж▓рж╛рж╕">
  <input id="loginRoll" placeholder="рж░рзЛрж▓">
  <select id="loginSection">
  <option value="">рж╢рж╛ржЦрж╛ ржирж┐рж░рзНржмрж╛ржЪржи</option>
  <option value="science">Science</option>
  <option value="arts">Arts</option>
  <option value="a">A</option>
  <option value="b">B</option>
</select>
  <input id="loginPhone" placeholder="ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░">
  <button onclick="studentLogin()">Login</button>
  <button id="dashBtn" onclick="showStudentDashboard()" style="display:none">
ЁЯУШ Dashboard
</button>
  <p id="loginMsg"></p>
</div>

 <div class="card section" id="studentDash" style="display:none">
  <h2>ЁЯСитАНЁЯОУ Student Dashboard</h2>

  <div id="myInfo"></div>

  <h3>ЁЯУК My Result</h3>
  <div id="myResult"></div>

  <h3>ЁЯУЕ My Class Routine</h3>
  <div id="myRoutine"></div>

  <button onclick="studentLogout()">Logout</button>
</div>

<!-- ===== Bottom Navigation ===== -->
<div class="bottom-nav">
  <button onclick="show('notice')">ЁЯУв<span>Notice</span></button>
  <button onclick="show('student')">ЁЯСитАНЁЯОУ<span>Student</span></button>
  <button onclick="show('teacher')">ЁЯСйтАНЁЯПл<span>Teacher</span></button>
  <button onclick="show('result')">ЁЯУК<span>Result</span></button>
  <button onclick="show('routine')">ЁЯУЕ<span>Routine</span></button>
</div>

<footer>┬й 2026 Gobindapur Govt. High School</footer> 

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script> 

<script>
firebase.initializeApp({
apiKey:"AIzaSyA0loay6NSdcRQJ5q_qWCbvzQW10rgErV4",
databaseURL:"https://gghs-fcfe6-default-rtdb.firebaseio.com"
});
const db=firebase.database(); 

const ADMIN_USER="HKuk12";
const ADMIN_PASS="HKuk12@#*";
let admin=false; 

for(let i=1;i<=150;i++){
sRoll.innerHTML+=`<option>${i}</option>`;
rRoll.innerHTML+=`<option>${i}</option>`;
} 

function show(id){
document.querySelectorAll('.section').forEach(s=>{
┬а s.style.display="none";
┬а s.classList.remove("fade");
});
let el=document.getElementById(id);
el.style.display="block";
void el.offsetWidth;
el.classList.add("fade");
} 

function login(){
  if(user.value===ADMIN_USER && pass.value===ADMIN_PASS){
    admin=true;
    status.innerText="Logged In";
    document.querySelectorAll('.admin').forEach(a=>a.style.display="block");
    loadAll();
    loadPending(); // тЬЕ рж╢рзБржзрзБржорж╛рждрзНрж░ ржПржЦржи Pending ржжрзЗржЦрж╛ржмрзЗ
    show('notice');
  }else alert("Wrong Login");
}

function logout(){
  admin=false;
  status.innerText="Logged Out";
  document.querySelectorAll('.admin').forEach(a=>a.style.display="none");
  pendingList.innerHTML=""; // тЭМ logout рж╣рж▓рзЗ Pending clear
  loadAll();
  show('notice');
}

function del(path, key){
if(!admin){
┬а alert("Admin only");
┬а return;
} 

firebase.database().ref(path + "/" + key).remove()
.then(()=>{
┬а alert("Deleted Successfully"); 

┬а // ржпржжрж┐ рж░рзБржЯрж┐ржи рж╣рзЯ, рждрж╛рж╣рж▓рзЗ рж░рзБржЯрж┐ржи ржЖржмрж╛рж░ рж▓рзЛржб
┬а if(path === "routines"){
┬а┬а loadRoutine();
┬а }
})
.catch(err=>{
┬а alert("Delete failed: " + err.message);
});
} 

function addNotice(){ if(admin) db.ref("notices").push({text:noticeInput.value}); }
function addNews(){ if(admin) db.ref("news").push({text:newsInput.value}); }
function addStudent(){ if(admin) db.ref("students").push({name:sn.value,class:sc.value,roll:sr.value,section:ss.value}); }
function addTeacher(){
if(admin){
┬а db.ref("teachers").push({
┬а┬а name: tName.value,
┬а┬а sub: tSub.value,
┬а┬а phone: tPhone.value
┬а });
┬а tName.value="";
┬а tSub.value="";
┬а tPhone.value="";
}
}
function addResult(){
if(!admin){
┬а alert("Admin only");
┬а return;
} 

db.ref("results").push({
┬а name: resName.value,
┬а class: resClass.value,
┬а roll: resRoll.value,
┬а section: resSection.value,
┬а position: resPos.value,
┬а marks: resMarks.value
}); 

resName.value="";
resClass.value="";
resRoll.value="";
resSection.value="";
resPos.value="";
resMarks.value="";
} 

function load(path,list,template){
db.ref(path).on("value",snap=>{
┬а list.innerHTML="";
┬а snap.forEach(c=>{
┬а┬а list.innerHTML+=template(c);
┬а });
});
} 

function loadAll(){
load("notices",noticeList,c=>`<li>${c.val().text}${admin?` <button onclick="del('notices','${c.key}')">X</button>`:""}</li>`);
load("news",newsList,c=>`<li>${c.val().text}${admin?` <button onclick="del('news','${c.key}')">X</button>`:""}</li>`);
load("teachers", teacherList, c => `
<div class="teacher-card">
  <h3>${c.val().name}</h3>
  <p><b>ржмрж┐рж╖рзЯ:</b> ${c.val().sub}</p>
  <p>ЁЯУЮ ${c.val().phone || "ржирзЗржЗ"}</p>
  ${admin ? `<button onclick="del('teachers','${c.key}')">X</button>` : ""}
</div>
`);
load("students",studentList,c=>`<li>${c.val().name} | ${c.val().class}-${c.val().roll}${admin?` <button onclick="del('students','${c.key}')">X</button>`:""}</li>`);
load("results", resultList, c => `
<li>
<b>${c.val().name}</b><br>
ржХрзНрж▓рж╛рж╕: ${c.val().class} |
рж░рзЛрж▓: ${c.val().roll} |
рж╢рж╛ржЦрж╛: ${c.val().section}<br>
рж╕рзНржерж╛ржи: ${c.val().position} |
ржиржорзНржмрж░: ${c.val().marks}
${admin ? ` <button onclick="del('results','${c.key}')">X</button>` : ""}
</li>
`);
} 

loadAll(); 

function findStudent(){
  studentResult.innerHTML = "<span style='color:red;font-weight:bold;'>Not Found!</span>";
  
  const cls = sClass.value.trim();
  const roll = sRoll.value.trim();
  const section = sSection.value.trim().toLowerCase(); // lowercase

  db.ref("students").once("value", s=>{
    s.forEach(c=>{
      let d = c.val();

      let dClass = String(d.class).trim();
      let dRoll = String(d.roll).trim();
      let dSection = String(d.section).trim().toLowerCase(); // lowercase

      if(dClass === cls && dRoll === roll && dSection === section){
        studentResult.innerHTML = `
        <div class="student-card">
          <h3>ЁЯСитАНЁЯОУ ${d.name}</h3>
          <p><b>ржХрзНрж▓рж╛рж╕:</b> ${d.class}</p>
          <p><b>рж░рзЛрж▓:</b> ${d.roll}</p>
          <p><b>рж╢рж╛ржЦрж╛:</b> ${d.section}</p>
        </div>
        `;
      }
    });
  });
}

function findResult(){
resultOutput.innerHTML = "<span style='color:red;font-weight:bold;'>Not Found!</span>";

db.ref("results").once("value", s=>{
┬а s.forEach(c=>{
┬а┬а let d=c.val();
┬а┬а if(
┬а┬а┬а d.class===rClass.value &&
┬а┬а┬а d.roll===rRoll.value &&
┬а┬а┬а d.section===rSection.value
┬а┬а ){
┬а┬а┬а resultOutput.innerHTML=`
┬а┬а┬а <b>ржирж╛ржо:</b> ${d.name}<br>
┬а┬а┬а <b>ржХрзНрж▓рж╛рж╕:</b> ${d.class}<br>
┬а┬а┬а <b>рж░рзЛрж▓:</b> ${d.roll}<br>
┬а┬а┬а <b>рж╢рж╛ржЦрж╛:</b> ${d.section}<br>
┬а┬а┬а <b>рж╕рзНржерж╛ржи:</b> ${d.position}<br>
┬а┬а┬а <b>ржиржорзНржмрж░:</b> ${d.marks}
┬а┬а┬а `;
┬а┬а }
┬а });
});
} 

const addRtClass = document.getElementById("addRtClass"); 

function addRoutine(){
if(!admin){
┬а alert("Admin only");
┬а return;
} 

if(!addRtClass.value || !rtDay.value || !rtPeriod.value || !rtSub.value || !rtTeacher.value){
┬а alert("рж╕ржм ржлрж┐рж▓рзНржб ржкрзВрж░ржг ржХрж░рзЛ");
┬а return;
} 

db.ref("routines").push({
┬а class: addRtClass.value,
┬а day: rtDay.value,
┬а period: rtPeriod.value,
┬а subject: rtSub.value,
┬а teacher: rtTeacher.value
}); 

alert("Routine Added"); 

rtPeriod.value="";
rtSub.value="";
rtTeacher.value="";
} 

function loadRoutine(){
routineTable.innerHTML = ""; 

let cls = rtClass.value;
let dayFilter = document.getElementById("searchDay").value; 

if(!cls){
┬а alert("ржХрзНрж▓рж╛рж╕ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзЛ");
┬а return;
} 

let html = `
<table>
┬а <tr>
┬а┬а <th>ржмрж╛рж░</th>
┬а┬а <th>ржкрж┐рж░рж┐рзЯржб</th>
┬а┬а <th>ржмрж┐рж╖рзЯ</th>
┬а┬а <th>рж╢рж┐ржХрзНрж╖ржХ</th>
┬а┬а <th>Action</th>
┬а </tr>`; 

db.ref("routines").once("value")
.then(snapshot=>{
┬а snapshot.forEach(c=>{
┬а┬а let d = c.val(); 

┬а┬а if(d.class === cls && (dayFilter === "" || d.day === dayFilter)){
┬а┬а┬а html += `
┬а┬а┬а <tr>
┬а┬а┬а┬а <td>${d.day}</td>
┬а┬а┬а┬а <td>${d.period}</td>
┬а┬а┬а┬а <td>${d.subject}</td>
┬а┬а┬а┬а <td>${d.teacher}</td>
┬а┬а┬а┬а <td>
 ${admin ? `
 <button onclick="editRoutine(
  '${c.key}',
  '${d.period}',
  '${d.subject}',
  '${d.teacher}'
 )">Edit</button>

 <button onclick="del('routines','${c.key}')">Delete</button>
 ` : ""}
</td>
┬а┬а┬а </tr>`;
┬а┬а }
┬а }); 

┬а html += "</table>";
┬а routineTable.innerHTML = html;
});
}

function editRoutine(key, oldPeriod, oldSub, oldTeacher){
 if(!admin){
  alert("Admin only");
  return;
 }

 let newPeriod = prompt("ржирждрзБржи ржкрж┐рж░рж┐рзЯржб рж▓рж┐ржЦрзБржи:", oldPeriod);
 let newSub = prompt("ржирждрзБржи ржмрж┐рж╖рзЯ рж▓рж┐ржЦрзБржи:", oldSub);
 let newTeacher = prompt("ржирждрзБржи рж╢рж┐ржХрзНрж╖ржХ рж▓рж┐ржЦрзБржи:", oldTeacher);

 if(newPeriod && newSub && newTeacher){
  db.ref("routines/" + key).update({
   period: newPeriod,
   subject: newSub,
   teacher: newTeacher
  }).then(()=>{
   alert("Routine Updated");
   loadRoutine();
  });
 }
}

function toggleDark(){
  document.body.classList.toggle("dark");

  if(document.body.classList.contains("dark")){
    localStorage.setItem("theme","dark");
  }else{
    localStorage.setItem("theme","light");
  }
}

/* Page reload рж╣рж▓рзЗржУ theme ржерж╛ржХржмрзЗ */
if(localStorage.getItem("theme")==="dark"){
  document.body.classList.add("dark");
}

/* ===== DRAGGABLE DARK BUTTON ===== */
const darkBtn = document.getElementById("darkBtn");

let isDrag = false, offsetX = 0, offsetY = 0;

darkBtn.addEventListener("mousedown", startDrag);
darkBtn.addEventListener("touchstart", startDrag);

function startDrag(e){
  isDrag = true;
  const rect = darkBtn.getBoundingClientRect();
  const x = e.touches ? e.touches[0].clientX : e.clientX;
  const y = e.touches ? e.touches[0].clientY : e.clientY;
  offsetX = x - rect.left;
  offsetY = y - rect.top;
}

document.addEventListener("mousemove", drag);
document.addEventListener("touchmove", drag);

function drag(e){
  if(!isDrag) return;
  const x = e.touches ? e.touches[0].clientX : e.clientX;
  const y = e.touches ? e.touches[0].clientY : e.clientY;

  darkBtn.style.left = (x - offsetX) + "px";
  darkBtn.style.top  = (y - offsetY) + "px";
  darkBtn.style.right = "auto";
}

document.addEventListener("mouseup", stopDrag);
document.addEventListener("touchend", stopDrag);

function stopDrag(){
  isDrag = false;
}

/* Bottom nav active state */
document.querySelectorAll(".bottom-nav button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".bottom-nav button")
    .forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
  });
});

function signup(){
  if(
    !upName.value || !upClass.value ||
    !upRoll.value || !upSection.value || !upPhone.value
  ){
    alert("рж╕ржм ржлрж┐рж▓рзНржб ржкрзВрж░ржг ржХрж░рзЛ");
    return;
  }

  db.ref("pendingStudents").push({
  name: upName.value,
  class: upClass.value,
  roll: upRoll.value,
  section: upSection.value.toLowerCase(), // тЬЕ
  phone: upPhone.value
});

  signupMsg.innerText = "тЬЕ ржЖржмрзЗржжржи ржЬржорж╛ рж╣рзЯрзЗржЫрзЗ, Admin approval ржЕржкрзЗржХрзНрж╖рж╛рзЯ";
  
  upName.value="";
  upClass.value="";
  upRoll.value="";
  upSection.value="";
  upPhone.value="";
}

function approveStudent(key, name, cls, roll, section, phone){
  if(!admin){
    alert("Admin only");
    return;
  }

  db.ref("students").push({
    name: name,
    class: cls,
    roll: roll,
    section: section.toLowerCase(),
    phone: phone
  });

  db.ref("pendingStudents/" + key).remove();
  alert("тЬЕ Student Approved & Added");
}

function loadPending() {
  if(!admin) {
    pendingList.innerHTML = ""; // Admin ржирж╛ рж╣рж▓рзЗ ржЦрж╛рж▓рж┐ ржжрзЗржЦрж╛ржмрзЗ
    return;
  }

  db.ref("pendingStudents").on("value", snap => {
    pendingList.innerHTML = "";
    snap.forEach(c => {
      pendingList.innerHTML += `
        <li>
          ${c.val().name} | ${c.val().class}-${c.val().roll}
         <button onclick="approveStudent(
  '${c.key}',
  '${c.val().name}',
  '${c.val().class}',
  '${c.val().roll}',
  '${c.val().section}',
  '${c.val().phone}'  // тЬЕ phone ржкрж╛ржарж╛ржирзЛ
)">Approve</button>

          <button onclick="cancelStudent(
            '${c.key}'
          )" style="background:#dc3545;margin-left:5px;">Cancel</button>
        </li>
      `;
    });
  });
}

function cancelStudent(key){
  if(!admin){
    alert("Admin only");
    return;
  }

  if(confirm("ржПржЗ ржЖржмрзЗржжржи ржмрж╛рждрж┐рж▓ ржХрж░рждрзЗ ржЪрж╛ржУ?")){
    db.ref("pendingStudents/" + key).remove()
    .then(()=>{
      alert("тЭМ Student Signup Cancelled");
      loadPending(); // рж▓рж┐рж╕рзНржЯ refresh рж╣ржмрзЗ
    })
    .catch(err=>{
      alert("Cancel failed: " + err.message);
    });
  }
}

let studentLoggedIn = null; // рж▓ржЧрж┐ржи рж╕рзНржЯрзЗржЯ ржЯрзНрж░рзНржпрж╛ржХ ржХрж░ржмрзЗ

function studentLogin(){
  const cls = loginClass.value.trim();
  const roll = loginRoll.value.trim();
  const section = loginSection.value.trim().toLowerCase();
  const phone = loginPhone.value.trim();

  if(!cls || !roll || !section || !phone){
    loginMsg.innerText = "рж╕ржм ржлрж┐рж▓рзНржб ржкрзВрж░ржг ржХрж░рзЛ!";
    return;
  }

  db.ref("students").once("value").then(snap=>{
    let found = false;

    snap.forEach(c=>{
      let d = c.val();

      let dClass = String(d.class).trim();
      let dRoll = String(d.roll).trim();
      let dSection = String(d.section).trim().toLowerCase();
      let dPhone = String(d.phone || "").trim();

      if(
        dClass === cls &&
        dRoll === roll &&
        dSection === section &&
        (!dPhone || dPhone === phone)
      ){
        found = true;
        studentLoggedIn = {
          key: c.key,
          ...d
        };
      }
    });

    if(found){
  loginMsg.innerText = "тЬЕ Logged In Successfully!";

  // тЬЕ Dashboard button show рж╣ржмрзЗ
  document.getElementById("dashBtn").style.display = "block";

  // ржЪрж╛ржЗрж▓рзЗ рж╕рж░рж╛рж╕рж░рж┐ Dashboard ржП ржпрж╛ржмрзЗ
  showStudentDashboard();
  show('studentDash');

}else{
      loginMsg.innerText = "тЭМ Login Failed: Approved student ржирзЯ ржмрж╛ рждржерзНржп ржнрзБрж▓";
    }
  });
}

function showStudentDashboard(){
  document.querySelectorAll('.section').forEach(s=>{
    s.style.display = "none";
    s.classList.remove("fade");
  });

  let el = document.getElementById("studentDash");
  el.style.display = "block";
  void el.offsetWidth;
  el.classList.add("fade");

  myInfo.innerHTML = `
    <p><b>ржирж╛ржо:</b> ${studentLoggedIn.name}</p>
    <p><b>ржХрзНрж▓рж╛рж╕:</b> ${studentLoggedIn.class}</p>
    <p><b>рж░рзЛрж▓:</b> ${studentLoggedIn.roll}</p>
    <p><b>рж╢рж╛ржЦрж╛:</b> ${studentLoggedIn.section}</p>
    <p><b>ржорзЛржмрж╛ржЗрж▓:</b> ${studentLoggedIn.phone}</p>
  `;

  // тЬЕ ржПржЧрзБрж▓рзЛ HTML ржПрж░ ржмрж╛ржЗрж░рзЗ
  loadMyResult();
  loadMyRoutine();
}

function studentLogout(){
  studentLoggedIn = null;

  // ЁЯФ┤ Dashboard button hide рж╣ржмрзЗ
  document.getElementById("dashBtn").style.display = "none";

  loginClass.value = "";
  loginRoll.value = "";
  loginSection.value = "";
  loginPhone.value = "";
  loginMsg.innerText = "";

  show('auth'); // ржЖржмрж╛рж░ Login / Signup ржжрзЗржЦрж╛ржмрзЗ
}

function autoFixOldStudents(){
  if(!admin){
    alert("Admin only");
    return;
  }

  db.ref("students").once("value").then(snap=>{
    snap.forEach(c=>{
      let d = c.val();
      let updates = {};

      // phone ржирж╛ ржерж╛ржХрж▓рзЗ placeholder
      if(!d.phone){
        updates.phone = "0000000000";
      }

      // section lowercase
      if(d.section){
        updates.section = String(d.section).toLowerCase();
      }

      if(Object.keys(updates).length > 0){
        db.ref("students/" + c.key).update(updates);
      }
    });

    alert("тЬЕ Old students auto updated!");
  });
}
function loadMyResult(){
  myResult.innerHTML = "тП│ Loading...";

  db.ref("results").once("value", snap=>{
    let found = false;
    myResult.innerHTML = "";

    snap.forEach(c=>{
      let d = c.val();

      if(
        String(d.class) === String(studentLoggedIn.class) &&
        String(d.roll) === String(studentLoggedIn.roll) &&
        String(d.section).toLowerCase() === String(studentLoggedIn.section).toLowerCase()
      ){
        found = true;
        myResult.innerHTML = `
          <div class="student-card">
            <p><b>ржирж╛ржо:</b> ${d.name}</p>
            <p><b>ржХрзНрж▓рж╛рж╕:</b> ${d.class}</p>
            <p><b>рж░рзЛрж▓:</b> ${d.roll}</p>
            <p><b>рж╢рж╛ржЦрж╛:</b> ${d.section}</p>
            <p><b>рж╕рзНржерж╛ржи:</b> ${d.position}</p>
            <p><b>ржиржорзНржмрж░:</b> ${d.marks}</p>
          </div>
        `;
      }
    });

    if(!found){
      myResult.innerHTML = "<p class='not-found'>тЭМ Result ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐</p>";
    }
  });
}

function loadMyRoutine(){
  myRoutine.innerHTML = "тП│ Loading...";

  let cls = String(studentLoggedIn.class);
  let routineByDay = {};

  db.ref("routines").once("value", snap=>{
    snap.forEach(c=>{
      let d = c.val();

      if(String(d.class) === cls){
        let day = d.day;

        if(!routineByDay[day]){
          routineByDay[day] = [];
        }
        routineByDay[day].push(d);
      }
    });

    if(Object.keys(routineByDay).length === 0){
      myRoutine.innerHTML = "<p class='not-found'>тЭМ Routine ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐</p>";
      return;
    }

    let html = "";

    for(let day in routineByDay){
      html += `<h4>ЁЯУЕ ${day}</h4>`;
      html += `
      <table>
        <tr>
          <th>ржкрж┐рж░рж┐рзЯржб</th>
          <th>ржмрж┐рж╖рзЯ</th>
          <th>рж╢рж┐ржХрзНрж╖ржХ</th>
        </tr>`;

      routineByDay[day].forEach(r=>{
        html += `
        <tr>
          <td>${r.period}</td>
          <td>${r.subject}</td>
          <td>${r.teacher}</td>
        </tr>`;
      });

      html += "</table>";
    }

    myRoutine.innerHTML = html;
  });
}

/* ===== AI QUESTION & ANSWER SYSTEM ===== */

function addAIQA(){
  if(!admin){
    alert("Admin only");
    return;
  }

  if(!aiQ.value || !aiA.value){
    alert("ржкрзНрж░рж╢рзНржи ржУ ржЙрждрзНрждрж░ рж▓рж┐ржЦрзБржи");
    return;
  }

  db.ref("aiQA").push({
    question: aiQ.value,
    answer: aiA.value
  });

  aiQ.value="";
  aiA.value="";
}

/* Load AI Questions */
db.ref("aiQA").on("value", snap=>{
  aiQuestionList.innerHTML="";
  snap.forEach(c=>{
    aiQuestionList.innerHTML += `
      <li>
        <b onclick="showAIAnswer('${c.key}', \`${c.val().answer}\`)"
           style="cursor:pointer;color:#0b5ed7">
          тЭУ ${c.val().question}
        </b>
        ${admin ? `<button onclick="del('aiQA','${c.key}')">X</button>` : ""}
      </li>
    `;
  });
});

/* Typing Effect AI Answer */
function showAIAnswer(key, answer){
  aiAnswerBox.style.display="block";
  aiAnswerText.innerHTML="";
  
  let i = 0;
  let speed = 25; // typing speed

  function type(){
    if(i < answer.length){
      aiAnswerText.innerHTML += answer.charAt(i);
      i++;
      setTimeout(type, speed);
    }
  }
  type();
}
</script> 

</body>
  </html>
